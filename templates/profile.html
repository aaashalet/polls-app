{% extends "layout.html" %}

{% block content %}
  <h2>User Profile</h2>

  <!-- Avatar -->
  <div class="mb-4">
    {% if current_user.avatar_filename %}
      <img src="{{ url_for('static', filename='uploads/' ~ current_user.avatar_filename) }}" class="avatar" alt="Avatar">
    {% else %}
      <img src="https://via.placeholder.com/40" class="avatar" alt="Avatar">
    {% endif %}
    <span>{{ current_user.username }}</span>
  </div>

  <!-- Change Password Form -->
  <h4>Change Password</h4>
  <form method="POST">
    {{ pwd_form.hidden_tag() }}

    <div class="mb-3">
      {{ pwd_form.old_password.label(class="form-label") }}
      {{ pwd_form.old_password(class="form-control") }}
      {% for error in pwd_form.old_password.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <div class="mb-3">
      {{ pwd_form.new_password.label(class="form-label") }}
      {{ pwd_form.new_password(class="form-control") }}
      {% for error in pwd_form.new_password.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <div class="mb-3">
      {{ pwd_form.new_password2.label(class="form-label") }}
      {{ pwd_form.new_password2(class="form-control") }}
      {% for error in pwd_form.new_password2.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <button type="submit" class="btn btn-primary">{{ pwd_form.submit.label.text }}</button>
  </form>

  <!-- Polls Voted -->
  <hr>
  <h4>Polls You've Voted In</h4>
  {% if polls_voted %}
    <ul class="list-group">
      {% for poll, option_text in polls_voted.items() %}
        <li class="list-group-item">
          <a href="{{ url_for('poll_detail', poll_id=poll.id) }}">{{ poll.question }}</a>
          <span class="badge bg-secondary">{{ option_text }}</span>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>You haven't voted in any polls yet.</p>
  {% endif %}
{% endblock %}
